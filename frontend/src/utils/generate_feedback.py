import pandas as pd
import json
import numpy as np
import google.generativeai as genai
from dotenv import load_dotenv
import os

load_dotenv()

with open('data/deadpool.json', 'r') as file:
    pose_data = json.load(file)

expected = {('LEFT_WRIST',
  'LEFT_ELBOW'): [([0.16246870160102844,
    -0.12224894762039185,
    0.03257684409618378],
   [-0.08752050995826721,
    -0.18894527852535248,
    -0.006874002516269684]), ([0.14407852292060852, -0.1335708647966385, 0.04858019948005676],
   [-0.08619403839111328,
    -0.18895403295755386,
    -0.00925302505493164]), ([0.11295229196548462, -0.14477282762527466, 0.053463250398635864],
   [-0.08422903716564178,
    -0.19214896857738495,
    -0.008549056947231293]), ([0.09496861696243286, -0.15728426724672318, 0.04571232199668884],
   [-0.08383344113826752,
    -0.19558653235435486,
    -0.005789265036582947]), ([0.07348182797431946, -0.17062007635831833, 0.006395667791366577],
   [-0.08285114169120789,
    -0.2031027153134346,
    -0.0067420899868011475]), ([0.0687762200832367, -0.20985457859933376, -0.017468154430389404],
   [-0.0828557163476944,
    -0.20132115483283997,
    -0.007212847471237183]), ([0.050556957721710205, -0.23265949822962284, -0.030992738902568817],
   [-0.09138639271259308,
    -0.19385365396738052,
    -0.0033959969878196716]), ([0.06359699368476868, -0.23770127445459366, -0.04011238366365433],
   [-0.0904320776462555,
    -0.19092432409524918,
    -0.0013664811849594116]), ([0.06190085411071777, -0.24316158890724182, -0.04279796779155731],
   [-0.08550627529621124,
    -0.18685181438922882,
    -0.006681136786937714]), ([0.03785637021064758, -0.23626362904906273, -0.03522781282663345],
   [-0.08344468474388123,
    -0.18756157159805298,
    -0.007094442844390869]), ([-0.00900617241859436, -0.22508598491549492, -0.03226054459810257],
   [-0.08191598951816559,
    -0.18635337054729462,
    -0.005307108163833618]), ([-0.02498278021812439, -0.22608520090579987, -0.02340584248304367],
   [-0.08197332918643951, -0.18285555392503738, -0.0032144635915756226])],
 ('LEFT_ELBOW',
  'LEFT_SHOULDER'): [([0.08939428627490997,
    -0.17147308588027954,
    0.02751433104276657],
   [0.08740372955799103,
    -0.16657906770706177,
    -0.02712886780500412]), ([0.08889542520046234, -0.17283451557159424, 0.03546757996082306],
   [0.08691833913326263,
    -0.16772273182868958,
    -0.0270133838057518]), ([0.08457612991333008, -0.17807680368423462, 0.03488563001155853],
   [0.08413074910640717,
    -0.1687270700931549,
    -0.026843726634979248]), ([0.08022570610046387, -0.18338564038276672, 0.02963949739933014],
   [0.08567866683006287,
    -0.16922342777252197,
    -0.026323355734348297]), ([0.06890401244163513, -0.1908387839794159, 0.015840530395507812],
   [0.08662132918834686,
    -0.1711673140525818,
    -0.030408844351768494]), ([0.05737592279911041, -0.20678213238716125, -0.009500309824943542],
   [0.08844928443431854,
    -0.178168386220932,
    -0.03022243082523346]), ([0.04856473207473755, -0.22223728895187378, -0.025760486721992493],
   [0.0992087721824646,
    -0.1853124499320984,
    -0.028759151697158813]), ([0.03709828853607178, -0.23255667090415955, -0.03584036976099014],
   [0.10884232819080353,
    -0.18743813037872314,
    -0.02127090096473694]), ([0.04033540189266205, -0.23452463746070862, -0.04632355272769928],
   [0.10978202521800995,
    -0.19396546483039856,
    -0.01823905110359192]), ([0.05728781223297119, -0.22693240642547607, -0.04729308933019638],
   [0.10952557623386383,
    -0.19441631436347961,
    -0.017353489995002747]), ([0.08235833048820496, -0.2205864042043686, -0.0537840873003006],
   [0.10908158123493195,
    -0.19500640034675598,
    -0.018154554069042206]), ([0.08891385793685913, -0.21539868414402008, -0.04157864302396774],
   [0.10760948061943054, -0.19496306777000427, -0.023037627339363098])],
 ('LEFT_SHOULDER',
  'RIGHT_SHOULDER'): [([0.3070743829011917,
    -0.06963694095611572,
    0.05040691792964935],
   [0.29622140526771545,
    -0.05339357256889343,
    0.03782238811254501]), ([0.3074767738580704, -0.06589671969413757, 0.05040883272886276],
   [0.29655832052230835,
    -0.053589701652526855,
    0.03835102170705795]), ([0.3056073933839798, -0.06441736221313477, 0.0463828444480896],
   [0.29873986542224884,
    -0.05352535843849182,
    0.03933641314506531]), ([0.30706725269556046, -0.0621623694896698, 0.04298301786184311],
   [0.3005445599555969,
    -0.05177393555641174,
    0.035879381000995636]), ([0.31264933943748474, -0.06730663776397705, 0.043070316314697266],
   [0.3013865798711777,
    -0.049909621477127075,
    0.0362192839384079]), ([0.32297904044389725, -0.07489675283432007, 0.04541713744401932],
   [0.3020685464143753,
    -0.04964599013328552,
    0.03745894134044647]), ([0.3238978311419487, -0.07822391390800476, 0.04884669929742813],
   [0.3070911318063736,
    -0.05001750588417053,
    0.05974806845188141]), ([0.3298341855406761, -0.07844433188438416, 0.050096191465854645],
   [0.3066808581352234,
    -0.05131646990776062,
    0.07344835996627808]), ([0.3211282193660736, -0.0759502649307251, 0.05070872604846954],
   [0.3061685264110565,
    -0.05404427647590637,
    0.08261069655418396]), ([0.31457000225782394, -0.078145831823349, 0.05704285204410553],
   [0.30604831874370575,
    -0.05411049723625183,
    0.08200465142726898]), ([0.31630076840519905, -0.08135965466499329, 0.07474002987146378],
   [0.3074163943529129,
    -0.054353415966033936,
    0.0807591900229454]), ([0.3007576451636851, -0.0873359739780426, 0.09197298809885979],
   [0.3073604553937912, -0.054983824491500854, 0.07531507313251495])],
 ('RIGHT_WRIST',
  'RIGHT_ELBOW'): [([-0.18483611941337585,
    -0.07635118067264557,
    0.12279041111469269],
   [0.08320631086826324,
    -0.19010337442159653,
    0.05293451249599457]), ([-0.18851348757743835, -0.10456578433513641, 0.10445372760295868],
   [0.0855928361415863,
    -0.19059113785624504,
    0.05079168826341629]), ([-0.1806381195783615, -0.1295086070895195, 0.09842570126056671],
   [0.08786062896251678,
    -0.19095371291041374,
    0.05108471214771271]), ([-0.13580313324928284, -0.1528395414352417, 0.09277623891830444],
   [0.09052659571170807,
    -0.18977978453040123,
    0.05166403204202652]), ([-0.09794251620769501, -0.15923421829938889, 0.07465888559818268],
   [0.09054097533226013,
    -0.18320653215050697,
    0.054810963571071625]), ([0.02060362696647644, -0.14061196893453598, 0.16851671040058136],
   [0.09607556462287903,
    -0.1649690717458725,
    0.05953297019004822]), ([0.050819456577301025, -0.040608540177345276, 0.2023850530385971],
   [0.0948866605758667,
    -0.13982927799224854,
    0.0806640237569809]), ([0.09775148332118988, 0.027695223689079285, 0.19456876814365387],
   [0.09069666266441345,
    -0.1412407010793686,
    0.09265284240245819]), ([0.093751085922122, 0.07367415726184845, 0.18762171268463135],
   [0.08618831634521484,
    -0.13818424940109253,
    0.09063838422298431]), ([0.06567905843257904, 0.0748266875743866, 0.2104266881942749],
   [0.08845779299736023,
    -0.1372176706790924,
    0.0906360000371933]), ([0.061279475688934326, 0.0492384135723114, 0.18636980652809143],
   [0.08920353651046753,
    -0.13847613334655762,
    0.09489008039236069]), ([0.027256719768047333, -0.04589658975601196, 0.1592584103345871],
   [0.0900324285030365, -0.14083677530288696, 0.09754680842161179])],
 ('RIGHT_ELBOW',
  'RIGHT_SHOULDER'): [([-0.08033156394958496,
    -0.2839619517326355,
    0.05935569852590561],
   [-0.1006922572851181,
    -0.28586776554584503,
    0.016921214759349823]), ([-0.08463487029075623, -0.2833433151245117, 0.04510519653558731],
   [-0.10342341661453247,
    -0.2856550067663193,
    0.018999218940734863]), ([-0.08799496293067932, -0.28542380034923553, 0.04184560477733612],
   [-0.10303428769111633,
    -0.28549158573150635,
    0.01987617462873459]), ([-0.08676128834486008, -0.2892181873321533, 0.04249843209981918],
   [-0.09977498650550842,
    -0.285102054476738,
    0.02395690232515335]), ([-0.08948014676570892, -0.2806518226861954, 0.022131800651550293],
   [-0.09670332074165344,
    -0.2835785001516342,
    0.023447833955287933]), ([-0.09034683555364609, -0.27009154856204987, 0.06781967729330063],
   [-0.0943073183298111,
    -0.27886442840099335,
    0.022955670952796936]), ([-0.08185658603906631, -0.26790958642959595, 0.09553316980600357],
   [-0.08673292398452759,
    -0.26796963810920715,
    0.018384411931037903]), ([-0.05343889445066452, -0.2691534012556076, 0.12107489258050919],
   [-0.08412346243858337,
    -0.248233824968338,
    0.017603270709514618]), ([-0.03833403438329697, -0.25784216821193695, 0.13393208384513855],
   [-0.08506353199481964,
    -0.23772859573364258,
    0.01693899929523468]), ([-0.06985370069742203, -0.24821007251739502, 0.13541054725646973],
   [-0.08820126950740814,
    -0.23526903986930847,
    0.019461214542388916]), ([-0.0990290604531765, -0.23750153183937073, 0.1530088111758232],
   [-0.0904456079006195,
    -0.23870065808296204,
    0.020634353160858154]), ([-0.13100163778290153, -0.2188505232334137, 0.07214334234595299],
   [-0.09015066921710968, -0.23963278532028198, 0.014291249215602875])],
 ('LEFT_SHOULDER',
  'LEFT_HIP'): [([0.09468889981508255,
    0.46209827717393637,
    0.13048535026609898],
   [0.08734413236379623,
    0.46737156459130347,
    0.16018326953053474]), ([0.09418600797653198, 0.46101911924779415, 0.17456312105059624],
   [0.08671277016401291,
    0.4679639146197587,
    0.15846677124500275]), ([0.0922524482011795, 0.45957249170169234, 0.18220465816557407],
   [0.08576127886772156,
    0.46792598767206073,
    0.15773732587695122]), ([0.09261054545640945, 0.45698056975379586, 0.19018754363059998],
   [0.08249668031930923,
    0.46754761575721204,
    0.1609613560140133]), ([0.10126642882823944, 0.45620859833434224, 0.18430758267641068],
   [0.08072835952043533,
    0.4672829443588853,
    0.165135957300663]), ([0.11614727973937988, 0.4494480970315635, 0.18070838041603565],
   [0.07912580668926239,
    0.46686592791229486,
    0.16569947451353073]), ([0.12438681721687317, 0.4434850784018636, 0.18174398317933083],
   [0.07734643667936325,
    0.4665093752555549,
    0.16133636981248856]), ([0.1391262337565422, 0.43419201485812664, 0.1818766351789236],
   [0.07745255529880524,
    0.46648901514708996,
    0.14976176619529724]), ([0.144867442548275, 0.4250487256795168, 0.1804381925612688],
   [0.07763060182332993,
    0.4637449549045414,
    0.16275876760482788]), ([0.1555299013853073, 0.42209824454039335, 0.18519474565982819],
   [0.07782112807035446,
    0.46377854188904166,
    0.16094670817255974]), ([0.17996743321418762, 0.42481181025505066, 0.17737357504665852],
   [0.07786186784505844,
    0.4634612309746444,
    0.16110301576554775]), ([0.19701670110225677, 0.43254360370337963, 0.1673080511391163],
   [0.07912959158420563, 0.46137780835852027, 0.17182180099189281])],
 ('RIGHT_SHOULDER',
  'RIGHT_HIP'): [([-0.020812347531318665,
    0.510396839119494,
    0.04617939703166485],
   [-0.04478410631418228,
    0.5220939632272348,
    0.04952168092131615]), ([-0.022037923336029053, 0.506970152258873, 0.08749248087406158],
   [-0.045573435723781586,
    0.5227894608979113,
    0.04731715843081474]), ([-0.024049930274486542, 0.5067109437659383, 0.0966279860585928],
   [-0.04806141555309296,
    0.5226260441122577,
    0.046856991946697235]), ([-0.02508048713207245, 0.5033682724460959, 0.10389674827456474],
   [-0.05301647633314133,
    0.5208498871070333,
    0.0535663478076458]), ([-0.021909020841121674, 0.5073631089180708, 0.09790913201868534],
   [-0.05559368431568146,
    0.5190743236453272,
    0.05744778737425804]), ([-0.017512165009975433, 0.5081016132608056, 0.0920186024159193],
   [-0.057841069996356964,
    0.5184782513824757,
    0.05694412812590599]), ([-0.010688669979572296, 0.5052662529051304, 0.09140418469905853],
   [-0.0642499178647995,
    0.5184755717637017,
    0.0368427149951458]), ([-0.001272544264793396, 0.494275632314384, 0.09060153178870678],
   [-0.06350357830524445,
    0.5194048834382556,
    0.014133643358945847]), ([0.013724058866500854, 0.4796604858711362, 0.08870333805680275],
   [-0.06271502375602722,
    0.5193059396697208,
    0.02056386135518551]), ([0.03108048439025879, 0.4719956237822771, 0.08781128749251366],
   [-0.06173575669527054,
    0.519372939306777,
    0.02054505981504917]), ([0.05411165580153465, 0.46957969292998314, 0.06548605673015118],
   [-0.06280267983675003,
    0.5193174474406987,
    0.0215790756046772]), ([0.08666398515924811, 0.46898235008120537, 0.04170314595103264],
   [-0.06114465743303299, 0.5178687520092353, 0.03708016872406006])],
 ('LEFT_HIP',
  'RIGHT_HIP'): [([0.1915731355547905,
    -0.02133837901055813,
    -0.033899035304784775],
   [0.16409316658973694,
    0.0013288260670378804,
    -0.07283920049667358]), ([0.19125284254550934, -0.01994568668305874, -0.03666180744767189],
   [0.16427211463451385,
    0.0012358446256257594,
    -0.07279859110713005]), ([0.18930501490831375, -0.017278910148888826, -0.03919382765889168],
   [0.16491717100143433,
    0.00117469800170511,
    -0.07154392078518867]), ([0.18937622010707855, -0.01577466679736972, -0.04330777749419212],
   [0.16503140330314636,
    0.0015283357934094965,
    -0.07151562720537186]), ([0.18947388976812363, -0.0161521271802485, -0.04332813434302807],
   [0.16506453603506088,
    0.0018817578093148768,
    -0.07146888598799706]), ([0.18931959569454193, -0.016243236605077982, -0.04327264055609703],
   [0.16510166972875595,
    0.0019663333368953317,
    -0.07129640504717827]), ([0.18882234394550323, -0.01644273940473795, -0.04149309918284416],
   [0.16549477726221085,
    0.0019486906239762902,
    -0.06474558636546135]), ([0.18943540751934052, -0.018360714428126812, -0.04117891192436218],
   [0.1657247245311737,
    0.0015993983834050596,
    -0.06217976287007332]), ([0.18998483568429947, -0.0213385047391057, -0.04102612845599651],
   [0.16582290083169937,
    0.0015167082892730832,
    -0.05958420969545841]), ([0.19012058526277542, -0.028248452581465244, -0.040340606123209],
   [0.16649143397808075,
    0.0014839001814834774,
    -0.058396996930241585]), ([0.19044499099254608, -0.036591771990060806, -0.037147488445043564],
   [0.16675184667110443,
    0.0015028005000203848,
    -0.05876475013792515]), ([0.19040492922067642, -0.050897227600216866, -0.03363191708922386],
   [0.16708620637655258, 0.0015071191592141986, -0.0594265591353178])],
 ('LEFT_HIP',
  'LEFT_KNEE'): [([0.0035142749547958374,
    0.39320304337888956,
    -0.001311328262090683],
   [0.04347222298383713,
    0.4090439563151449,
    -0.008856566622853279]), ([0.0036398544907569885, 0.38994852639734745, 0.007597774267196655],
   [0.044556524604558945,
    0.4092274799477309,
    -0.010099288076162338]), ([0.0027232542634010315, 0.388248058501631, 0.005911838263273239],
   [0.045058295130729675,
    0.40933478670194745,
    -0.011915549635887146]), ([0.0020415857434272766, 0.3888466521166265, 0.0018421150743961334],
   [0.044828470796346664,
    0.4094262218568474,
    -0.012507347390055656]), ([0.0069526731967926025, 0.39294623164460063, -0.0018927305936813354],
   [0.04221101477742195,
    0.4093866413459182,
    -0.012748649343848228]), ([0.008195005357265472, 0.39325715275481343, -0.01577594829723239],
   [0.04214373975992203,
    0.405111282132566,
    -0.010400468483567238]), ([0.010901525616645813, 0.39218816440552473, -0.036075284704566],
   [0.04269135370850563,
    0.40177416475489736,
    -0.009962912648916245]), ([0.01180478185415268, 0.38974122889339924, -0.06233084015548229],
   [0.04278937354683876,
    0.4036650378257036,
    -0.009101511910557747]), ([0.012862779200077057, 0.3884586524218321, -0.08253074996173382],
   [0.042762644588947296,
    0.39685065881349146,
    7.580593228340149e-05]), ([0.012970402836799622, 0.400571976788342, -0.07064694538712502],
   [0.042291540652513504,
    0.3947101072408259,
    0.0009913109242916107]), ([0.013367228209972382, 0.4031519889831543, -0.08521307446062565],
   [0.04028148576617241,
    0.39238812448456883,
    0.006914468482136726]), ([0.01180616021156311, 0.41778251715004444, -0.08313923701643944],
   [0.03662949055433273, 0.39233224699273705, 0.009420925751328468])],
 ('LEFT_KNEE',
  'LEFT_ANKLE'): [([0.006035514175891876,
    0.3096315860748291,
    0.22210674919188023],
   [0.04567883163690567,
    0.30619359016418457,
    0.19777381233870983]), ([0.012439973652362823, 0.31318381428718567, 0.22003445401787758],
   [0.04875844717025757,
    0.30628058314323425,
    0.1969863884150982]), ([0.013230018317699432, 0.3165684640407562, 0.1956843975931406],
   [0.04851086810231209,
    0.3035234212875366,
    0.19918407127261162]), ([0.015352495014667511, 0.3179398477077484, 0.1837867610156536],
   [0.04872516822069883,
    0.3007442355155945,
    0.19886533357203007]), ([0.02062620222568512, 0.3248034715652466, 0.1735689416527748],
   [0.04611515533179045,
    0.2964741885662079,
    0.19864597730338573]), ([0.019568584859371185, 0.32391607761383057, 0.16656955843791366],
   [0.045867362059652805,
    0.2930559813976288,
    0.20559956319630146]), ([0.017325103282928467, 0.31902873516082764, 0.16790427453815937],
   [0.04467118252068758,
    0.286662220954895,
    0.21981440857052803]), ([0.022578347474336624, 0.3178723156452179, 0.17530270665884018],
   [0.04131421190686524,
    0.2861596941947937,
    0.22662670351564884]), ([0.029264986515045166, 0.3184761106967926, 0.17392190173268318],
   [0.041227200388675556,
    0.28033626079559326,
    0.2529899440705776]), ([0.02773367613554001, 0.3204021453857422, 0.17965200915932655],
   [0.03999356692656875,
    0.27065664529800415,
    0.25271154195070267]), ([0.027008093893527985, 0.3277670741081238, 0.17340532690286636],
   [0.04118926636874676,
    0.2725902497768402,
    0.257455475628376]), ([0.025845568627119064, 0.32510653138160706, 0.18024326860904694],
   [0.043548325542360544, 0.27208277583122253, 0.26965684443712234])],
 ('RIGHT_HIP',
  'RIGHT_KNEE'): [([-0.0526505671441555,
    0.3353829374536872,
    0.0297500966116786],
   [-0.08241379703395069,
    0.34573336283210665,
    -0.027571048587560654]), ([-0.0485096238553524, 0.3347477465867996, 0.03768050670623779],
   [-0.08200618519913405,
    0.35005934786750004,
    -0.024866435676813126]), ([-0.04528610408306122, 0.333469751290977, 0.03664858639240265],
   [-0.0819799160817638,
    0.35190039698500186,
    -0.019989266991615295]), ([-0.04194403439760208, 0.3321910062804818, 0.02567868446931243],
   [-0.08117223445151467,
    0.35029658320127055,
    -0.020548652857542038]), ([-0.03358157351613045, 0.3328963238745928, 0.02608347311615944],
   [-0.08097197877395956,
    0.34957948041846976,
    -0.02131253108382225]), ([-0.03352517634630203, 0.3328260174021125, 0.026823580265045166],
   [-0.0808077627007151,
    0.3475778928550426,
    -0.022469352930784225]), ([-0.030174769461154938, 0.33210381492972374, 0.02533097192645073],
   [-0.07959095353726298,
    0.33839481126051396,
    -0.026712141931056976]), ([-0.008319616317749023, 0.33302554208785295, 0.016304602846503258],
   [-0.07868913654237986,
    0.33263022179016843,
    -0.034575071185827255]), ([0.040287718176841736, 0.31898414622992277, -0.08068602159619331],
   [-0.07709659961983562,
    0.3240961480187252,
    -0.040296344086527824]), ([0.07101104408502579, 0.2625557314604521, -0.1514664851129055],
   [-0.07188813108950853,
    0.322723419230897,
    -0.039067188277840614]), ([0.12466184794902802, 0.23631051555275917, -0.129713898524642],
   [-0.07234449125826359,
    0.32140261004678905,
    -0.03896906599402428]), ([0.17772624641656876, 0.18939854577183723, -0.151882104575634],
   [-0.07133114896714687, 0.3187231175834313, -0.04280122369527817])],
 ('RIGHT_KNEE',
  'RIGHT_ANKLE'): [([0.027358245104551315,
    0.35249561071395874,
    0.19207207020372152],
   [-0.065475131617859,
    0.37756165862083435,
    0.1632782369852066]), ([0.03890351578593254, 0.3542514443397522, 0.1895231083035469],
   [-0.06491360173095018,
    0.3775888681411743,
    0.16420046985149384]), ([0.0392264723777771, 0.3573329448699951, 0.17942666448652744],
   [-0.06481415720190853,
    0.37609219551086426,
    0.16586460173130035]), ([0.041040919721126556, 0.35970011353492737, 0.1698231310583651],
   [-0.0639227041247068,
    0.37583228945732117,
    0.16495689749717712]), ([0.03734060749411583, 0.3660903573036194, 0.17342016287148],
   [-0.0634663699365774,
    0.3756716549396515,
    0.1645636484026909]), ([0.03655361384153366, 0.36583295464515686, 0.17948869802057743],
   [-0.06214640055259224,
    0.3767791986465454,
    0.1589442938566208]), ([0.03235016018152237, 0.358122855424881, 0.19241979345679283],
   [-0.0634200539207086,
    0.38280054926872253,
    0.15388460084795952]), ([0.014740876853466034, 0.3205588161945343, 0.23041019216179848],
   [-0.06521131005138159,
    0.3827287554740906,
    0.13275622576475143]), ([-0.023301146924495697, 0.2626124620437622, 0.3091093450784683],
   [-0.06911559822037816,
    0.3834414482116699,
    0.12541218847036362]), ([-0.03180593252182007, 0.2635968178510666, 0.3061627149581909],
   [-0.07454271148890257,
    0.37717440724372864,
    0.12648388743400574]), ([-0.02889806032180786, 0.26299840211868286, 0.2942868024110794],
   [-0.07409982196986675,
    0.3753194212913513,
    0.1281021609902382]), ([0.027345716953277588, 0.29974642395973206, 0.27409491688013077],
   [-0.0752608124166727, 0.37664005160331726, 0.12874745577573776])]}

results = {}
average_losses = []

for key, frames in expected.items():
    frame_details = []
    l2_norms = []
    
    for frame in frames:
        exp_vec = np.array(frame[0])
        obs_vec = np.array(frame[1])
        
        diff = exp_vec - obs_vec
        l2_norm = np.linalg.norm(diff)
        l2_norms.append(l2_norm)
        
        dot = np.dot(exp_vec, obs_vec)
        norm_exp = np.linalg.norm(exp_vec)
        norm_obs = np.linalg.norm(obs_vec)
        
        cos_theta = dot / (norm_exp * norm_obs)
        cos_theta = np.clip(cos_theta, -1.0, 1.0)
        angle_rad = np.arccos(cos_theta)
        angle_deg = np.degrees(angle_rad)
        
        cross = np.cross(exp_vec, obs_vec)
        
        frame_details.append({
            "l2_norm": l2_norm,
            "angle_deg": angle_deg,
            "cross_product": cross
        })
    

    avg_loss = np.mean(l2_norms)
    results[key] = {
        "average_loss": avg_loss,
        "frame_details": frame_details
    }
    average_losses.append(avg_loss)

max_index = np.array(average_losses).argmax()
max_key = list(results.keys())[max_index]
selected_data = results[max_key]


api_key = os.getenv("API_KEY")

genai.configure(api_key=api_key)

model = genai.GenerativeModel('gemini-2.0-flash-lite')

prompt = f"""
In my dance teaching app, we evaluate a user's performance by comparing their body positions to expected positions using a scoring algorithm. For a specific joint pair over multiple frames, we compute deviations per frame. The computed deviations include:

- **average_loss**: The average L2 norm of the error vectors across frames.
- **frame_details**: A list where each entry contains:
  - **l2_norm**: The L2 norm of the error vector for that frame.
  - **angle_deg**: The angular difference (in degrees) between the expected and actual joint vectors.
  - **cross_product**: A 3D vector showing the directional difference between expected and actual vectors.

Here is an example for the joint pair with the highest average loss:

Highest Average Loss Key: {max_key}

{max_key} information:
{selected_data}

Your task is:

**Generate feedback based on this data.**  
Specifically:
- For this joint, give **clear, specific, and actionable advice** on how the user can adjust their body position to better match the expected pose.
- The feedback should be **one short, simple sentence**.
- Ensure the feedback is friendly and encouraging, suitable for a dance teaching app.

Do not include any additional explanation or preamble outside this format.
"""

response = model.generate_content(prompt)

print(response.text)
